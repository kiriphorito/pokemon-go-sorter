name: "Check Pvpoke Update"

on:
  schedule:
    - cron: "0 0/12 * * *"
  workflow_dispatch:

jobs:
  check_pvpoke_update:
    permissions:
      contents: write
      pull-requests: write
    runs-on: "ubuntu-latest"
    steps:
    - uses: actions/checkout@v4
    - name: "Run pvpoke download script"
      run: bash ./scripts/download_raw_data.sh
    - name: Verify Changed files
      uses: tj-actions/verify-changed-files@v20
      id: verify-changed-files
    - name: Run step only when any of the above files change.
      if: steps.verify-changed-files.outputs.files_changed == 'true'
      env:
        CHANGED_FILES: ${{ steps.verify-changed-files.outputs.changed_files }}
      run: |
        echo "Changed files: $CHANGED_FILES"
    - name: Create Pull Request
      if: steps.verify-changed-files.outputs.files_changed == 'true'
      uses: peter-evans/create-pull-request@v7
      with:
        commit-message: |
          Update Pvpoke data
        title: Update Pvpoke data
        body: |
          - Update Pvpoke data
          
          Auto-generated by [create-pull-request](https://github.com/peter-evans/create-pull-request)
        branch: update-pvpoke-data